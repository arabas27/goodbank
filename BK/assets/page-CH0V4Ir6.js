import{u as v,a as b,b as y,j as t,N as S,r as w,L as N,A as D,c as _,F as C,B as E}from"./index-DHY0aHRd.js";const $=()=>{const p=_(),[n]=b(),o=n.get("filter")||"ASC",x=parseInt(n.get("limit"))||50;return t.jsxs(C,{className:"flex flex-col gap-3",onSubmit:i=>{i.preventDefault();const f=new FormData(i.currentTarget);p(`./?filter=${f.get("filter")}&limit=${f.get("limit")}`)},children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("label",{htmlFor:"filter",children:"ตัวกรอง"}),t.jsxs("select",{className:"px-3 py-1 border  border-gray-500 rounded",defaultValue:o,name:"filter",id:"filter",children:[t.jsx("option",{value:"DESC",children:"ผลรวมคะแนนมากไปหาน้อย"}),t.jsx("option",{value:"ASC",children:"ผลรวมคะแนนน้อยไปหามาก"})]})]}),t.jsx("div",{className:"flex flex-col",children:t.jsxs("div",{className:"flex flex-row items-center border border-gray-500 rounded text-nowrap",children:[t.jsx("div",{className:"px-3 py-1 rounded-s",children:"จำนวนแสดง"}),t.jsx("input",{className:"px-3 py-1 text-end border-x border-gray-500 focus:outline focus:outline-2 w-full",type:"number",name:"limit",id:"limit",defaultValue:x,onClick:i=>i.currentTarget.select()}),t.jsx("div",{className:"px-3 py-1 rounded-e",children:"รายการ"})]})}),t.jsx("button",{type:"submit",className:"bg-blue-500 px-3 py-1 rounded text-white font-bold",children:t.jsxs("div",{className:"flex flex-row gap-3 items-center justify-center",children:[t.jsx(E,{className:"w-5 h-5"}),t.jsx("span",{children:"ค้นหา"})]})})]})};function F(){const p=v(),{response:n}=p,[o]=b(),x=o.get("filter")||"ASC",i=o.get("limit")||"50",{state:f}=y(),I=f==="loading";return t.jsxs("div",{className:"flex flex-col gap-3 w-full",children:[t.jsx(S,{}),t.jsx(w.Suspense,{fallback:t.jsx(N,{}),children:t.jsx(D,{resolve:n,children:I?t.jsx(N,{}):g=>{const{allStd:h}=g,{allReport:u}=g,a=[],m=[];u.forEach((s,e)=>{const r=h.findIndex(c=>c.std_id===s.std_id);if(s.step==="99"||s.process_status==="deleted")m.push(e);else{const c=r!==-1?h[r]:null;if(c){const l=Date.parse("2024-05-01 00:00:00"),j=Date.parse(s.create_at);c.level.toString()==="4"&&j<l&&m.push(e)}}}),m.reverse().forEach(s=>u.splice(s,1)),u.forEach((s,e,r)=>{if(r.findIndex(l=>l.std_id===s.std_id)===e)a.push({stdId:s.std_id,total:100+(s.type==="deduct"?-1*parseInt(s.score):s.type==="add"?parseInt(s.score):0)});else{const l=a.findIndex(j=>j.stdId===s.std_id);s.type==="deduct"?a[l].total+=-1*parseInt(s.score):s.type==="add"?a[l].total+=parseInt(s.score):a[l].total+=0}}),h.forEach(s=>{const e=a.findIndex(r=>r.stdId===s.std_id);e!==-1&&(a[e].title=s.title,a[e].firstname=s.firstname,a[e].lastname=s.lastname,a[e].level=s.level,a[e].section=s.section),e===-1&&a.push({stdId:s.std_id,total:100,title:s.title,firstname:s.firstname,lastname:s.lastname,level:s.level,section:s.section})});let d=a.filter(s=>s.firstname);return x==="DESC"?d.sort((s,e)=>e.total-s.total):x==="ASC"&&d.sort((s,e)=>s.total-e.total),d=d.slice(0,parseInt(i)),t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"px-3",children:[t.jsx("h3",{className:"text-xl font-bold mb-3",children:"สรุปผล"}),t.jsx("div",{className:"p-3 bg-gray-100 rounded",children:t.jsx($,{})})]}),t.jsx("div",{className:"px-3 w-full bg-gray-100 py-1",children:t.jsxs("table",{className:"w-full bg-white rounded",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsx("th",{className:"text-start ps-1",children:"ที่"}),t.jsx("th",{className:"text-start ps-1",children:"ชื่อ-สกุล"}),t.jsx("th",{className:"text-start ps-1",children:"ชั้น"}),t.jsx("th",{className:"text-start ps-1",children:"คะแนน"})]})}),t.jsx("tbody",{children:d.map((s,e)=>{const r=parseInt(s.total.toString());return t.jsxs("tr",{children:[t.jsx("td",{className:"ps-1",children:e+1}),t.jsx("td",{className:"ps-1",children:`${s.title==="เด็กชาย"?"ด.ช.":s.title==="เด็กหญิง"?"ด.ญ.":s.title}${s.firstname} ${s.lastname}`}),t.jsx("td",{className:"ps-1",children:`ม.${s.level}/${s.section}`}),t.jsx("td",{className:`ps-1 font-bold ${r>0?"text-green-600":r<0?"text-red-600":"text-black"}`,children:r})]},e)})})]})})]})}})})]})}export{F as default};
